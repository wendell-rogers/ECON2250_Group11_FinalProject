---
title: "ECON2250_Group11_FinalProject"
author: "Wendell, Connor, & Caroline"
date: "2025-11-19"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=TRUE}
# Install Necessary Packages
options(repos = c(CRAN = "https://cran.rstudio.com/"))

packages <- c("tidyverse", "tidycensus", "bea.R", "janitor")
install.packages(setdiff(packages, rownames(installed.packages())))
lapply(packages, library, character.only = TRUE)

install.packages("tinytex")
library(tinytex)

# Enable Census Data
census_api_key("fa1f22a59be49b0aa3a0a638fc8ec6ab84af62be", install = TRUE, overwrite = TRUE)

# Enable BEA Data
bea_Key <- "9EFC7A8B-2A67-486D-9F8B-6AA3A26DBCF8"

beaGet(list(
  'UserID' = bea_Key,
  'Method' = 'GetParameterValues',
  'datasetname' = 'Regional'
))

# Stops BEA Related Errors
safe_bea_data <- function(bea_object) {
  if (!("Data" %in% names(bea_object))) {
    print("X: BEA returned an error instead of data:")
    print(bea_object)
    stop("Fix the BEA request above â€” no $Data field found.")
  }
  return(bea_object$Data)
}

# Pull economic data
income_data <- get_acs(
  geography = "county",
  variables = "B19013_001",
  year = 2020,
  survey = "acs5"
) %>%
  select(county = NAME, median_income = estimate)

# Education Variables
education_var <- c("B15003_022", "B15003_023", "B15003_024", "B15003_025")

# Pull education data
education_raw <- get_acs(
  geography = "county",
  variables = education_var,
  year = 2020,
  survey = "acs5"
)

education_final <- education_raw %>%
  group_by(NAME) %>%
  summarise(
    edu_bachelors_plus = sum(estimate)
  ) %>%
  rename(county = NAME)

# Race Variables
race_var <- c(
  black = "DP05_0038PE",
  hispanic = "DP05_0071PE",
  asian = "DP05_0066PE",
  white = "DP05_0037PE"
)

# Pull Race Data
race_data <- get_acs(
  geography = "county",
  variables = race_var,
  year = 2020,
  survey = "acs5"
) %>%
  select(county = NAME, variable, estimate) %>%
  spread(variable, estimate)

# Pull Age Data
age_data <- get_acs(
  geography = "county",
  variables = "DP05_0017E",
  year = 2020,
  survey = "acs5"
) %>%
  select(county = NAME, median_age = estimate)

# Pull Income Per Capita
income_per_capita <- get_acs(
  geography = "county",
  variables = "B19301_001",
  year = 2020,
  survey = "acs5"
) %>%
  select(county = NAME, bea_personal_income = estimate)

# Pull County GDP
county_gdp_final <- get_acs(
  geography = "county",
  variables = "B01003_001",
  year = 2020,
  survey = "acs5"
) %>%
  select(county = NAME, gdp_county = estimate)

# Get Data Together
county_data <- income_data %>%
  left_join(education_final, by = "county") %>%
  left_join(race_data, by = "county") %>%
  left_join(age_data, by = "county") %>%
  left_join(income_per_capita, by = "county") %>%
  left_join(county_gdp_final, by = "county") %>%
  clean_names()

# Develop Regression Model
regression_model <- lm(
  median_income ~ edu_bachelors_plus + dp05_0038p + dp05_0071p + dp05_0066p + dp05_0037p + median_age + bea_personal_income + gdp_county, 
  data = county_data
)

summary(regression_model)

# Summary Scatter Plot
library(ggplot2)

ggplot(county_data, aes(x = bea_personal_income, y = median_income)) +
  
  geom_point(
    alpha = 0.5, 
    color = "darkblue"
  ) + 
  geom_smooth(
    method = "lm", 
    color = "red", 
    se = FALSE
  ) + 
  
  labs(
    title = "County Median Household Income vs. Per Capita Income",
    subtitle = "Visualizing the Relationship of the Outcome Variable with the Strongest Predictor",
    x = "Per Capita Income (USD)",
    y = "Median Household Income (USD)"
  ) +
  
  theme_minimal() +
  
  scale_y_continuous(labels = scales::dollar) +
  scale_x_continuous(labels = scales::dollar)
```